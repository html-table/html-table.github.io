customElements.define("html-table",class extends HTMLElement{constructor(){super().attachShadow({mode:"open"}).innerHTML=document.getElementById(this.nodeName+"-STYLE").innerHTML+"<style id=show></style><style id=filter></style>";this._t=this.query("table");this._f=this.query("#filter");this._s=this.query("#show");this.columns={}}query(e,t=this.shadowRoot){return(t||this).querySelector(e)}connectedCallback(){let e=this;console.timers=new Proxy([{label:"start",time:0,duration:0}],{set(t,s,r){if(!e.hasAttribute("timers"))return!0;if("length"!=s){r=String(r);let e=t.slice(-1)[0],i=Number(performance.now().toFixed(0));t[s]={label:r,time:r.includes("*")?0:i,duration:i-e.time};r.includes("*")}return!0}});this.json?this.load(this.json):setTimeout((async()=>{this.for=this.getAttribute("for");this.shadowRoot.append(...this.querySelectorAll("[shadowRoot]"));if(this.for)if(this.for.startsWith("http")){let e=await(await fetch(this.for)).json(),t=this.getAttribute("headerrow")||0,s=this.for.includes("google"),r=e;s&&(r=e.feed.entry);this.headers={};Array.isArray(r)||(r=[...Object.entries(r)].reduce(((e,[t,s])=>!Array.isArray(e)&&Array.isArray(s)?s:e),r));if(!Array.isArray(r))return;r=r.slice(t,9999).map((e=>{s&&Object.entries(e).map((([t,s],r)=>{if(r=t.split("gsx$")[1]){this.headers[r]?r=this.headers[r]:this.headers[r]=r;e[r]=s.$t}delete e[t]}));return e}));this.load(r)}else{let e=this.query("#"+this.for,document)||this.query("#"+this.for,this.getRootNode().host);if(e)try{this.load(JSON.parse(e.innerHTML))}catch(e){}document.addEventListener(this.for,(e=>{let t=e.detail.rows;this.load(t)}))}}))}get show(){this.getAttribute("show")}set show(e="*"){this.setAttribute("show",e);this._s.innerHTML=`tbody tr[data-article*="${e}"]{background:lightgreen}`}row(e){}TRtoggle(e,t){"number"==typeof t&&(t=this.row(t))}parseStr=(e,t={})=>new Function("v","return(("+Object.keys(t).join(",")+")=>`"+e+"`)(...Object.values(v))")(t);load(e,t=this.querySelector("#columns")){e.headers;t&&[...t.content.children].map((e=>this.columns[e.getAttribute("name")||e.localName]=e.innerHTML.split("\n").map((e=>e.trim())).join("")));if(e.length){(e=e.map((e=>({sel:(this.columns.sel||"")+"<input type='checkbox'>",...e})))).length>1&&new Set(Object.keys(e[0]),Object.keys(e[1])).size==Object.keys(e[0]).length&&e.unshift(Object.keys(e[0]));this.$table=e.reduceRight(((e,t,s,r,i=r.length-1,o=(this.getAttribute("pagesizes")||"5,10,20,30,40").split`,`.concat(i),l=this.getAttribute("pagesize")||Number(o[0]),n=3,a=(e=>Object.entries(t).map(e)),u=((e,t,r,i=document.createElement(e))=>{t&&("string"==typeof t?i.setAttribute("data-value",i.innerHTML=t):i.append(t));if(r){i.setAttribute("data-colname",r);i.setAttribute("aria-rowindex",s);d.append(i)}return i}),d=u("tr"))=>{if(s){d.row=t;d.setAttribute("role","row");d.setAttribute("aria-roleindex",s);d.setAttribute("data-index",s);a((([r,o],l)=>{this.columns[r]&&(o=this.parseStr(this.columns[r],{rowindex:s,colname:r,value:o,colindex:l,total:i,...t}));if("string"!=typeof o)if(Array.isArray(o)){n=document.createElement(this.localName);n.json=o;valueIsTable=!0;o=n}else o=typeof o;let n,a=u(0==l?"th":"td",o,r);a.setAttribute("role","cell");a.setAttribute("data-isnumber",Number(o)==o);a.setAttribute("data-colnr",l);a.setAttribute("title",o);d.setAttribute("data-"+r,o);n&&a.setAttribute("is-table",r);if(l){e.columns.get(r)||e.columns.set(r,new Map);e.columns.get(r).get(o)||e.columns.get(r).set(o,[]);e.columns.get(r).get(o).push(t)}}));d.toggle=(e=!d.querySelector("input").checked)=>{d.querySelector("input").checked=e;d.classList.toggle("selected",e)};d.onclick=e=>{"INPUT"!=e.target.nodeName&&d.toggle()};e.TRs.unshift(d)}else{let t;a((([s,r],i,o)=>{let l,n,a=u("div",r),d=u("style"),h=u("th",a,r),c=u("select",""),p=u("div"),b=e.columns.get(r);h.id=this.id+"_"+r;h.append(d,p);e.THns[r]=h;e.THs.push(h);e.groupby.push(c);h.setAttribute("role","columnheader");h.setAttribute("aria-label",r);h.setAttribute("aria-colindex",i);h.update=(t=!1)=>{if(!b)return;let s,i=(e,t)=>{n=u("option",((e,t)=>`(${t}) `+e)(e,t.length));n.setAttribute("value",e);return n},o=e.selected.map((e=>e.row[r])),l=c.value||"*";c.replaceChildren(i("*",h.values),...[...b.entries()].map((([e,r])=>{s=i(e,r);t?s.setAttribute("inselection",o.includes(e)):s.removeAttribute("inselection");return s})).reduceRight(((e,t,s,r,i=((t,s=document.createElement("optgroup"))=>{s.setAttribute("label","¥Y"[t]+" ("+e[t].length+")");s.append(...e[t].sort(((e,t)=>e.value.localeCompare(t.value))));return e[t]=e[t].length?s:""}))=>{e["false"==t.getAttribute("inselection")?0:1].unshift(t);return s?e:[i(1),i(0)]}),[[],[]]));c.value=l;c.options[0].scrollIntoView()};if(b){h.values=[...b.values()].flatMap((e=>e)).map((e=>e[r]));h.update();h.setAttribute("data-isnumber",h.isNumber=h.values.every((e=>Number(e)==e)));c.classList.add("columnfilter");c.setAttribute("size",15);c.setAttribute("data-colname",r);h.append(c);c.onchange=()=>h.groupby(c.value)}i&&(t.next=h);t=h;h.setwidth=e=>h.style.width=e+"px";p.style="top:0;right:0;width:5px;position:absolute;cursor:col-resize;user-select:none;height:100%";var g,m,y,f;p.onmousedown=e=>{m=h;g=e.pageX;y=m.offsetWidth;m.next&&(f=m.next.offsetWidth)};this.addEventListener("mousemove",(e=>{if(m){m.next&&m.next.setwidth(f-(e.pageX-g));m.setwidth(y+(e.pageX-g))}}));this.addEventListener("mouseup",(e=>g=f=y=void 0));h.groupby=t=>{if(h.values.includes(t)){e.grouped[r]=t;e.pager("groupby:"+r);d.innerHTML=`select[data-colname="${r}"]{background:var(--filterColor,#9cc)}`}else{d.innerHTML="";delete e.grouped[r];e.pager()}c.value=t};a.onclick=e=>h.sort();h.sorted=0;h.sort=(t=++h.sorted,s=!0,i=[...e.tbody.querySelectorAll("tr")])=>{i.length,e.sort;l=l||[...i];if(3==t){h.sorted=0;e.sort=e.sort.filter((e=>X.sorted))}a.setAttribute("data-sort"," ▲▼"[h.sorted]);if(h.sorted){e.sortTHs.add(h);let s=i.sort(((e,s,i=(e=>(e.row[r],e.row[r])))=>h.isNumber?Number(i(2==t?s:e))-Number(i(2==t?e:s)):i(2==t?s:e).localeCompare(i(2==t?e:s),"en")));s.map((e=>{}));e.tbody.innerHTML="";e.tbody.replaceChildren(...s)}else{e.sortTHs.delete(h);e.tbody.replaceChildren(...l)}s&&e.pager()}}));let s=this.getAttribute("rowindex")||1,r=(t,r=u("b","&nbsp;&nbsp;"+"de«‹›»"[t]+"&nbsp;&nbsp;"),o=(r.onclick=()=>e.pager(2==t?s=1:3==t?s-=l:4==t?s+=l:s=i-i%l+1)))=>r,h=u("td"),c=u("tr"),p=u("style"),b=u("span"),g=u("select",o.map((e=>`<option style=display:inline-block value=${e}>${e}</option>`)).join``);g.onchange=()=>e.pager(s,Number(g.value));h.id="pager";h.setAttribute("colspan","100%");c.append(h);h.append(b,r(2),r(3),g,r(4),r(5),p);e.thead.append(d);e.tfoot.append(c);e.table.append(e.thead,e.tbody,e.tfoot);e.table.setAttribute("role","table");e.table.style.tableLayout="fixed";e.pager=(t=s,r=l)=>{let o=Object.keys(e.grouped);e.selected=e.TRs.filter((t=>o.map((s=>t.row[s]==e.grouped[s])).every((e=>e))));let a=o.length?e.selected.length:0;if("string"==typeof t&&t.includes("groupby")){t=1;e.selected.length}t=s=Number(t);r=Number(r);t<1&&(t=1);g.value=l=r;if(a-l<n){l=a||l;p.innerHTML="#pager b,#pager #pages{visibility:hidden}"}else{t>i&&(t=i-l);p.innerHTML=""+(t+l<i?1==t?"#pager b:nth-of-type(1),#pager b:nth-of-type(2){visibility:hidden}":"":"#pager b:nth-of-type(3),#pager b:nth-of-type(4){visibility:hidden}")}e.selected=e.selected.slice(s-1,s+l-1);e.selected.length;e.sortTHs;[...e.sortTHs.values()].map((e=>e.sort(e.sorted,0)));e.tbody.replaceChildren(...e.selected);b.innerHTML=`<span id=pages><button>1</button> [prevpages] ${t} ⎯ ${t+e.selected.length-1} [nextpages] /</span> ${i} `+(a?" ⭃ "+a:"");let u=e.THs.reduce(((e,t)=>{t.update(!0);let s=t.querySelector("optgroup")?.children.length||1;return e>s?e:s}),1);e.groupby.map((t=>t.size=e.grouped.size?u<11?u+4:11:1))}}return e}),{columns:new Map,groupby:[],grouped:{},TRs:[],selected:[],THs:[],THns:{},sortTHs:new Set,TH:e=>"object"==typeof e?e:"number"==typeof e?this.$table.THs[e]:this.$table.THns[e],table:document.createElement("table"),thead:document.createElement("thead"),tbody:document.createElement("tbody"),tfoot:document.createElement("tfoot")});window.TM=this.$table;this.shadowRoot.append(this.$table.table);this.$table.pager(this.getAttribute("rownr")||1);this.$table.TH("Cors")?.sort()}}filter(e,t){}sort(e=this.getAttribute("sort"),t=this.$table.TH(e)){t&&t.sort()}});